{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="{% static 'Login/js/session_timeout.js' %}"></script> -->
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{% static 'Login/CSS/profile.css' %}">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"> -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    
   
    <title>Profile</title>
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
       
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
       
       
        .modal::backdrop {
            backdrop-filter: blur(5px);
        }
        body {
            font-family: "Poppins", sans-serif;
            font-weight: 300;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
   
        #form-container {
            margin-top: 30px;
        }
   
        #success-message {
            display: none;
            margin-top: 10px;
        }
   
        .height {
            height: 100vh;
        }
   
        .card {
            padding: 20px;
            border: 2px solid black;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
   
        form {
            width: 100%;
        }
   
        label {
            display: block;
            margin-bottom: 8px;
        }
   
        input {
            width: 100%;
            height: 40px;
            margin-bottom: 15px;
            padding: 8px;
            box-sizing: border-box;
        }
   
        img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 10px;
        }
   
        .file-actions {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
   
        .file-actions label,
        .file-actions button {
            margin-right: 10px;
        }
   
        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
   
        .col-md-6 {
            width: 48%;
        }
   
        .inputs {
            display: flex;
            flex-direction: column;
        }
   
        .actions {
            display: flex;
            justify-content: space-between;
        }
   
        button {
            padding: 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
   
        .btn-primary {
            background-color: #581ed6;
            /* #3498db; */
            color: #fff;
        }
   
        .btn-secondary {
            background-color: #95a5a6;
            color: #fff;
        }
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Center items vertically */
            padding: 10px;
            background-color: #333;
            color: #fff;
        }
 
        .profile-text {
            margin-left: 100px;
            font-size: 24px;
            color: #581ed6
            /* #3498db; */
        }
 
        .profile {
            display: flex;
            align-items: center; /* Center the content vertically */
        }
 
        .profile img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-left: 10px;
        }
        .text{
            color: #581ed6;
        }
        .emoji{
            color:#581ed6;
        }
        /* .btn{
            color:#581ed6;
        } */
        #remove-picture{
            background-color: #581ed6;
            color: white;
        }
        .post-flex-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px; /* Adjust the gap between posts as needed */
}

.post-item {
    width: calc(40%); /* 50% width with a gap of 20px */
    box-sizing: border-box;
    background-color: cornflowerblue;
    border-radius: 5px;
    list-style: none;
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid black; 
}
#added img {
    width: 50%; /* Adjust the width as needed */
    margin-left: 25%; 
    height: auto; /* Maintain aspect ratio */
    border-radius: 10px; /* Add rounded corners */
    
}

    </style>
 
</head>
<body>
   

    <section id="sidebar">
        <a href="#" class="brand">
            <i class='bx bxs-smile emoji' ></i>
            <span class="text">
                {% if user.is_authenticated %}
                    Hi, {{ user.username }}
                {% else %}
                    My Profile
                {% endif %}
            </span>
        </a>
        <ul class="side-menu top">
            <li >
                <a href="{% url 'base' %}">
                    <i class='bx bxs-dashboard emoji' ></i>
                    <span class="text">Home</span>
                </a>
            </li>
   
            <li>
                <a href="#" id="edit-profile-link">
                    <i class='bx bxs-doughnut-chart emoji'></i>
                    <span class="text">Edit Profile</span>
                </a>
            </li>
           
            <li>
                <a href="" id="my-posts-link">
                    <i class='bx bxs-shopping-bag-alt emoji' ></i>
                    <span class="text">My Posts</span>
                </a>
            </li>
           
           
           
            <li>
                <a href="#" id="chats-link">
                    <i class='bx bxs-message-dots emoji'></i>
                    <span class="text">Chats</span>
                </a>
               
 
            </li>
       
            <li>
                <a href="{% url 'logout' %}" id="logoutButton">
                    <i class='bx bxs-log-out-circle emoji' ></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>
    <div id="logoutModal" class="modal">
        <div class="modal-content">
            <p>Are you sure you want to exit?</p>
            <button id="confirmLogout">Yes</button>
            <button id="cancelLogout">No</button>
        </div>
    </div>
    <section id="content">
       
            <!-- NAVBAR -->
            <nav>
                <!-- <i class='bx bx-menu' ></i> -->
                <div class="profile-text">
                    <b>Enhance your profile! Make your profile shine.</b>
                </div>
                </a>
                <a href="" class="profile">
                    <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}https://th.bing.com/th/id/OIP.TouNZxZ6zY-HetqfYQ1GHQD6D6?w=216&h=215&c=7&r=0&o=5&dpr=1.5&pid=1.7{% endif %}" alt="Profile Picture">
                </a>
            </nav>

        <main>
            <section id="added" class="initially">
                <img id="hiding" src="https://img.freepik.com/free-vector/designer-girl-concept-illustration_114360-2090.jpg?size=626&ext=jpg&ga=GA1.1.1894579647.1706434369" alt="Profile Image">
            </section> 
            <div id="form-container" class="container">
        
                <div class="row height d-flex justify-content-center align-items-center">
                    <div class="col-md-8">
                        <div class="card py-5">
                            <form id="edit-profile-form" method="post" enctype="multipart/form-data" onsubmit="showSuccessMessage()">
                                {% csrf_token %}
                                <div class="row mt-3">
                                    <div class="mt-3 px-4 col-md-6">
                                        <!-- <label for="profile-picture" class="text-uppercase name">Profile Picture</label> -->
                                        <div class="d-flex flex-row align-items-center mt-2">
                                
                                            <img id="profile-picture" src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}https://th.bing.com/th/id/OIP.TouNZxZ6zY-HetqfYQ1GHQD6D6?w=216&h=215&c=7&r=0&o=5&dpr=1.5&pid=1.7{% endif %}" alt="Profile Picture" width="60" class="rounded">
                                            <div class="ml-3">
                                                <input type="hidden" name="remove_picture" id="remove-picture-input" value="">
                                                <input type="file" id="file-input1" style="display: none;" name="profile_picture" accept="image/*"  value="{{ user.profile_picture }}">
                                                <button type="button" id="remove-picture" class="btn" onclick="document.getElementById('file-input1').click()">upload</button>
                                                <input type="hidden" name="remove_picture" id="remove-picture-input" value="">
                                                <input type="file" id="file-input1" style="display: none;" name="profile_picture" accept="image/*" value="{{ user.profile_picture }}">
                                                <button type="button" id="remove-picture" class="btn" onclick="removePicture()">Remove</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="inputs px-4">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label for="first-name" class="text-uppercase">First Name</label>
                                                    <input type="text" id="first-name" name="first_name" value="{{ user.first_name }}">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="last-name" class="text-uppercase">Last Name</label>
                                                    <input type="text" id="last-name" name="last_name" value="{{ user.last_name }}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="inputs px-4">
                                            <label for="username" class="text-uppercase">Username</label>
                                            <input type="text" id="username" name="username" value="{{ user.username }}">
                                        </div>
                                        <div class="inputs px-4">
                                            <label for="email" class="text-uppercase">Email</label>
                                            <input type="email" id="email" name="email" value="{{ user.email }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3 px-4 d-flex justify-content-end align-items-center">
                                    <button type="button" class="btn btn-primary" onclick="confirmUpdateProfile()">Update</button>
                                </div>
                                
                            </form>
                        </div>
                    </div>
                </div>
            </div>
           
           
           <div id="my-posts-container" class="post-container">
    <div class="post-flex-container">
        {% for post in user_posts %}
            <div class="post-item">
                <div class="post1-container">
                    <strong>Passenger Name:</strong> {{ post.passenger_name }}<br>
                    <strong>Date of Journey:</strong> {{ post.date_of_journey }}<br>
                    <strong>Gender:</strong> {{ post.gender }}<br>
                    <strong>Flight Number:</strong> {{ post.flight_number }}<br>
                    <strong>PNR Number:</strong> {{ post.pnr_number }}<br>
                    <strong>Source:</strong> {{ post.source }}<br>
                    <strong>Destination:</strong> {{ post.destination }}<br>
                    <strong>Baggage Space:</strong> {{ post.baggage_space }} kgs<br>
                </div>
                <div id="options-menu-{{ post.id }}" class="options-menu">
                    <ul>
                        <button type="button" class="btn btn-danger" onclick="confirmDelete('{{ post.id }}')">Delete</button>
                    </ul>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

    
    <ul id="chat-rooms-container" class="submenu">
        {% for post in user_posts %}
            {% if post.baggage_number %}
                <li>
                   
                    <a href="{% url 'room' room=post.baggage_number %}">
                        <span class="text">{{ post.passenger_name }} - Room {{ post.baggage_number }}</span>
                    </a>
         
                </li>
            {% else %}
                <li>
                    <span class="text">{{ post.passenger_name }} - No Chat Room</span>
                </li>
            {% endif %}
        {% endfor %}
    </ul>

    <ul id="messages-container" class="submenu">
      <!-- Messages will be displayed here -->
    </ul>


        </main>
    </section>
 
            <div>{% block content %} {% endblock %}</div>
        </div>
 
        <script>



            function fetchMessages() {
                fetch('/app1/getAllMessages/')  // Replace with the actual URL of your view
                    .then(response => response.json())
                    .then(data => {
                        // Extract messages from the response
                        const messages = data.messages;
             
                        // Extract unique combinations of user and room using a Set
                        const uniqueUserRoomSet = new Set(messages.map(message => `${message.user}-${message.room_name}`));
                        const uniqueUserRooms = Array.from(uniqueUserRoomSet);
             
                        // Display messages in the HTML page
                        const messagesContainer = document.getElementById('messages-container');
                        messagesContainer.innerHTML = '';  // Clear previous messages
             
                        uniqueUserRooms.forEach(userRoom => {
                            const [user, room_name] = userRoom.split('-');
                            const roomLink = document.createElement('a');
                            roomLink.href = `/app1/${room_name}/`; // Replace with the actual URL pattern
                            console.log(roomLink.href);
                            roomLink.innerHTML = `<span class="text">${user} - Room - ${room_name}</span>`;
                            roomLink.addEventListener('click', function (event) {
                                event.preventDefault();  // Prevent the default link behavior
                                window.location.href = roomLink.href;  // Navigate to the room URL
                            });
                            const messageElement = document.createElement('li');
                            messageElement.appendChild(roomLink);
                            messagesContainer.appendChild(messageElement);
                        });
                    })
                    .catch(error => console.error('Error:', error));
            }
             
            // Call the fetchMessages function when the page loads
            window.onload = fetchMessages;



    //          function removeProfilePicture() {
    //     // Reset the profile picture to the default image URL
    //     document.getElementById('profile-picture').src = 'https://th.bing.com/th/id/OIP.Ntwccxljc9Gmka_Y6InYMAHaHa?rs=1&pid=ImgDetMain';
    // }
    document.addEventListener("DOMContentLoaded", function () {
        const editProfileLink = document.getElementById("edit-profile-link");
        const formContainer = document.getElementById("form-container");
        const editProfileForm = document.getElementById("edit-profile-form");
       
        const profilePicture = document.getElementById("profile-picture");
   
        formContainer.style.display = "none";
        let isFormDirty = false;
   
        editProfileLink.addEventListener("click", function (event) {
            event.preventDefault();
            formContainer.style.display = "block";
            successMessage.style.display = "none";
        });
   
        const otherLinks = document.querySelectorAll("#my-posts-link, #chats-link, .logout");
        otherLinks.forEach(link => {
            link.addEventListener("click", function (event) {
                event.preventDefault();
                if (isFormDirty) {
                    const userResponse = confirm("You have unsaved changes. Do you really want to leave?");
                    if (!userResponse) {
                        return;
                    }
                }
                formContainer.style.display = "none";
                successMessage.style.display = "none";
            });
        });
   
        editProfileForm.addEventListener("submit", function (event) {
            event.preventDefault();
   
            const formData = new FormData(editProfileForm);
   
            fetch(editProfileForm.action, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    successMessage.style.display = "block";
                    editProfileForm.reset();
                    formContainer.style.display = "block";
                    isFormDirty = false;
   
                    // Update the profile data on the page dynamically
                    updateProfileData(data);
   
                    if (data.profile_picture_url) {
                        profilePicture.src = data.profile_picture_url;
                    }
                } else {
                    console.error('Profile update failed');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
   
        // Detect form changes to prompt user before leaving the page
        editProfileForm.addEventListener("input", function () {
            isFormDirty = true;
        });
   
        // Handle cancel button click
        // Handle cancel button click
        
        document.addEventListener("DOMContentLoaded", function () {
            // ... your existing code ...
        
            const removePictureButton = document.getElementById("remove-picture");
            removePictureButton.addEventListener("click", function () {
                // Set the value of the hidden input field to 'true' when the "Remove" button is clicked
                document.getElementById('remove-picture-input').value = 'true';
        
                // Trigger form submission
                document.getElementById('edit-profile-form').submit();
            });
        });
   

    });
    
   const allSideMenu = document.querySelectorAll('#sidebar .side-menu.top li a');
       
                allSideMenu.forEach(item => {
                    const li = item.parentElement;
       
                    item.addEventListener('click', function () {
                        allSideMenu.forEach(i => {
                            i.parentElement.classList.remove('active');
                        })
                        li.classList.add('active');
       
                        contentContainer.innerHTML = "";
                    })
                });
       
                // Your existing script...
                const menuBar = document.querySelector('#content nav .bx.bx-menu');
                const sidebar = document.getElementById('sidebar');
       
                menuBar.addEventListener('click', function () {
                    sidebar.classList.toggle('hide');
                });
       
                const searchButton = document.querySelector('#content nav form .form-input button');
                const searchButtonIcon = document.querySelector('#content nav form .form-input button .bx');
                const searchForm = document.querySelector('#content nav form');
       
                searchButton.addEventListener('click', function (e) {
                    if (window.innerWidth < 576) {
                        e.preventDefault();
                        searchForm.classList.toggle('show');
                        if (searchForm.classList.contains('show')) {
                            searchButtonIcon.classList.replace('bx-search', 'bx-x');
                        } else {
                            searchButtonIcon.classList.replace('bx-x', 'bx-search');
                        }
                    }
                });
       
                if (window.innerWidth < 768) {
                    sidebar.classList.add('hide');
                } else if (window.innerWidth > 576) {
                    searchButtonIcon.classList.replace('bx-x', 'bx-search');
                    searchForm.classList.remove('show');
                }
       
                window.addEventListener('resize', function () {
                    if (this.innerWidth > 576) {
                        searchButtonIcon.classList.replace('bx-x', 'bx-search');
                        searchForm.classList.remove('show');
                    }
                });
       
                const switchMode = document.getElementById('switch-mode');
       
                switchMode.addEventListener('change', function () {
                    if (this.checked) {
                        document.body.classList.add('dark');
                    } else {
                        document.body.classList.remove('dark');
                    }
                });
       
        </script>
       
       
       
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const allSideMenu = document.querySelectorAll('#sidebar .side-menu.top li a');
                const chatRoomsContainer = document.getElementById("chat-rooms-container");
               // const joinedChannelsContainer = document.getElementBhyId("joined-channels-container");
            
                // Hide chat rooms and joined channels initially
                chatRoomsContainer.style.display = 'none';
               // joinedChannelsContainer.style.display = 'none';
            
                allSideMenu.forEach(item => {
                    const li = item.parentElement;
            
                    item.addEventListener('click', function () {
                        allSideMenu.forEach(i => {
                            i.parentElement.classList.remove('active');
                        })
                        li.classList.add('active');
            
                        // Toggle the visibility of Chats and Joined Channels based on the clicked icon
                        chatRoomsContainer.style.display = item.id === "chats-link" ? "block" : "none";
                      //  joinedChannelsContainer.style.display = item.id === "chats-link" ? "block" : "none";
                    })
                });
            });
            
        </script>
       
       
       
    <script>
        function loadChats(roomId) {
            $.ajax({
                type: 'GET',
                url: `/app1/getMessages/${roomId}/`,
                dataType: 'json',
                success: function (response) {
                    console.log('Successfully fetched chat messages:', response);
                    displayChatMessages(response.messages);
                },
                error: function (error) {
                    console.error('Error fetching chat messages:', error);
                }
            });
        }
 
        function displayChatMessages(messages) {
            console.log('Displaying Chat Messages:', messages);
            // Update your DOM here with the received messages
            // For simplicity, this example just displays an alert
            alert('Chat Messages:\n' + JSON.stringify(messages));
        }
 
        function enterChatRoom(postId) {
            $.ajax({
                type: 'GET',
                url: `/app1/getRoomId/${postId}/`,
                dataType: 'json',
                success: function (response) {
                    console.log('Successfully fetched roomId:', response.roomId);
                    loadChats(response.roomId);
                },
                error: function (error) {
                    console.error('Error fetching roomId:', error);
                }
            });
        }
 
   
    </script>
    <script>
        $(document).ready(function () {
            $('#chatsList a').each(function () {
                var postId = $(this).data('post-id');
                enterChatRoom(postId);
            });
        });
    </script>
 
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const allSideMenu = document.querySelectorAll('#sidebar .side-menu.top li a');
            const myPostsContainer = document.getElementById("my-posts-container");
 
            allSideMenu.forEach(item => {
                const li = item.parentElement;
 
                item.addEventListener('click', function () {
                    allSideMenu.forEach(i => {
                        i.parentElement.classList.remove('active');
                    })
                    li.classList.add('active');
 
                    // Toggle the visibility of My Posts based on the clicked icon
                    myPostsContainer.classList.toggle('show', item.id === "my-posts-link");
 
                    // Hide the content container for other icons
                    const contentContainer = document.querySelector(".content-container");
                    contentContainer.style.display = item.id === "my-posts-link" ? "block" : "none";
                })
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const addedSection = document.getElementById("added");
        
            // Initially visible
            addedSection.style.display = "block";
        
            const hideAddedSection = function () {
                addedSection.style.display = "none";
            };
        
            const showAddedSection = function () {
                addedSection.style.display = "block";
            };
        
            // Attach event listeners to other icons
            const otherLinks = document.querySelectorAll("#edit-profile-link, #my-posts-link, #chats-link, .logout");
            otherLinks.forEach(link => {
                link.addEventListener("click", function (event) {
                    event.preventDefault();
                    // Hide the added section when other icons are clicked
                    hideAddedSection();
                });
            });
        
            // You can call showAddedSection() when you want to show the section
        });
        
    </script>
 
    <!-- Your existing scripts... -->
 
    <!-- <style>
        .content-container {
            display: none;
        }
 
        .content-container.show {
            display: block;
        }
    </style> -->
    <style>
        #my-posts-container {
            display: none;
        }

        .post-container {
            padding: 10px;
        }
   
        #my-posts-container.show {
            display: flex;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const editProfileLink = document.getElementById("edit-profile-link");
            const contentContainer = document.querySelector(".profile-content");
   
            editProfileLink.addEventListener("click", function (event) {
                event.preventDefault();
   
                // Fetch the content from the server (you might need to adjust the URL)
                fetch("{% url 'edit_profile' %}")
                    .then(response => response.text())
                    .then(data => {
                        // Replace the content in the profile content area with the loaded data
                        contentContainer.innerHTML = data;
                    });
            });
   
            const allSideMenu = document.querySelectorAll('#sidebar .side-menu.top li a');
   
            allSideMenu.forEach(item => {
                const li = item.parentElement;
   
                item.addEventListener('click', function () {
                    allSideMenu.forEach(i => {
                        i.parentElement.classList.remove('active');
                    })
                    li.classList.add('active');
   
                    // Hide the edit profile form when clicking on other icons
                    contentContainer.innerHTML = "";
                })
            });
        });
            // Your existing script...
            
    </script>
    <script>
    function confirmDelete(postId) {
        const isConfirmed = confirm('Are you sure you want to delete this post?');
        if (isConfirmed) {
            const csrfToken = getCookie('csrftoken');
   
            // Send a DELETE request to your server to delete the post
            fetch(`/app1/postAPI/${postId}/`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
            })
            .then(response => {
                if (response.status === 204) {
                    // Remove the deleted post from the UI
                    const postItem = document.getElementById(`options-menu-${postId}`).closest('.post-item');
                    postItem.remove();
                    alert('Post deleted successfully');
                } else {
                    alert('Failed to delete the post.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to delete the post.');
            });
        }
    }
   
    // Function to get CSRF token from cookies
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
</script>  
   
   
 
    <!-- for my posts  -->
    <!-- <script>
        document.addEventListener("DOMContentLoaded", function () {
            const myPostsLink = document.getElementById("my-posts-link");
            const myPostsContainer = document.getElementById("my-posts-container");
   
            myPostsLink.addEventListener("click", function (event) {
                event.preventDefault();
               
           
                myPostsContainer.classList.toggle('show');
            });
   
       
   
        });
    </script>
    <style>
        #my-posts-container {
            display: none;
        }
   
        #my-posts-container.show {
            display: block;
        }
    </style>
     -->
     <script>
        window.onload = function () {
            document.getElementById('logoutButton').addEventListener('click', function (event) {
                event.preventDefault(); // Prevent the default form submission
   
                var logoutModal = document.getElementById('logoutModal');
                logoutModal.style.display = 'flex';
           
                document.getElementById('confirmLogout').addEventListener('click', function () {
                    // Redirect to the logout URL only if the user clicks "Yes"
                    window.location.href = "{% url 'logout' %}";
                });
           
                document.getElementById('cancelLogout').addEventListener('click', function () {
                    logoutModal.style.display = 'none';
                });
            });
        };
    </script>

  

    <script>
        function confirmUpdateProfile() {
            const csrfToken = getCookie('csrftoken');
            const formData = new FormData($('#edit-profile-form')[0]);
    
            // Assuming your update profile endpoint is /app1/updateProfileAPI/
            $.ajax({
                type: 'POST',  // Use the appropriate HTTP method for updating profile
                url: '/app1/profile/',  // Replace with your actual update profile endpoint
                data: formData,
                processData: false,
                contentType: false,
                headers: {
                    'X-CSRFToken': csrfToken,
                },
                success: function (response) {
                    // Show a single alert message
                    alert('Profile updated successfully! Please refresh the page to see the updated profile.');
                    
                    // Reload the page immediately
                    location.reload();
                },
                error: function (error) {
                    console.error('Error updating profile:', error);
                    alert('Failed to update the profile.');
                }
            });
        }
    
    
    </script>
    
    
   
</body>
</html>





